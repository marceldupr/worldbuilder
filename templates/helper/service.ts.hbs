/**
 * {{name}}
 * {{description}}
 */

{{#if (eq integration "sendgrid")}}
import sgMail from '@sendgrid/mail';

sgMail.setApiKey(process.env.SENDGRID_API_KEY || '');
{{else if (eq integration "stripe")}}
import Stripe from 'stripe';

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY || '', {
  apiVersion: '2023-10-16',
});
{{else if (eq integration "twilio")}}
import twilio from 'twilio';

const client = twilio(
  process.env.TWILIO_ACCOUNT_SID,
  process.env.TWILIO_AUTH_TOKEN
);
{{else if (eq integration "supabase")}}
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  process.env.SUPABASE_URL || '',
  process.env.SUPABASE_KEY || ''
);
{{/if}}

export class {{pascalCase name}}Helper {
{{#each methods}}
  /**
   * {{name}}
   * @param {{parameters}}
   * @returns {{returns}}
   */
  async {{camelCase name}}({{parameters}}): {{returns}} {
{{#if (eq ../integration "sendgrid")}}
{{#if (eq name "sendTransactional")}}
    try {
      await sgMail.send({
        to,
        from: process.env.FROM_EMAIL || '',
        templateId: template,
        dynamicTemplateData: data,
      });
      return true;
    } catch (error) {
      console.error('Email error:', error);
      return false;
    }
{{else}}
    // Custom SendGrid method: {{name}}
    console.log('⚠ Custom SendGrid method needs implementation: {{name}}');
    return true;
{{/if}}
{{else if (eq ../integration "stripe")}}
{{#if (eq name "createPaymentIntent")}}
    try {
      const paymentIntent = await stripe.paymentIntents.create({
        amount: Math.round(amount * 100), // Convert to cents
        currency: currency || 'usd',
      });
      return paymentIntent;
    } catch (error) {
      console.error('Payment error:', error);
      throw error;
    }
{{else if (eq name "confirmPayment")}}
    try {
      const paymentIntent = await stripe.paymentIntents.confirm(intentId);
      return paymentIntent.status === 'succeeded';
    } catch (error) {
      console.error('Payment confirmation error:', error);
      return false;
    }
{{else if (eq name "refundPayment")}}
    try {
      const refund = await stripe.refunds.create({
        payment_intent: intentId,
        amount: amount ? Math.round(amount * 100) : undefined,
      });
      return refund;
    } catch (error) {
      console.error('Refund error:', error);
      throw error;
    }
{{else}}
    // Custom Stripe method: {{name}}
    console.log('⚠ Custom Stripe method needs implementation: {{name}}');
    throw new Error('Custom Stripe method needs implementation');
{{/if}}
{{else if (eq ../integration "supabase")}}
{{#if (eq name "uploadFile")}}
    try {
      const { data: uploadData, error } = await supabase.storage
        .from(bucket)
        .upload(path, file);
      
      if (error) throw error;
      
      return this.getPublicUrl(bucket, path);
    } catch (error) {
      console.error('Upload error:', error);
      throw error;
    }
{{else if (eq name "getPublicUrl")}}
    const { data } = supabase.storage
      .from(bucket)
      .getPublicUrl(path);
    
    return data.publicUrl;
{{else if (eq name "deleteFile")}}
    try {
      const { error } = await supabase.storage
        .from(bucket)
        .remove([path]);
      
      if (error) throw error;
      return true;
    } catch (error) {
      console.error('Delete file error:', error);
      throw error;
    }
{{else}}
    // Custom Supabase method: {{name}}
    console.log('⚠ Custom Supabase method needs implementation: {{name}}');
    throw new Error('Custom Supabase method needs implementation');
{{/if}}
{{else if (eq ../integration "twilio")}}
{{#if (eq name "sendSMS")}}
    try {
      await client.messages.create({
        body: message,
        from: process.env.TWILIO_PHONE_NUMBER,
        to,
      });
      return true;
    } catch (error) {
      console.error('SMS error:', error);
      return false;
    }
{{else if (eq name "sendWhatsApp")}}
    try {
      await client.messages.create({
        body: message,
        from: `whatsapp:${process.env.TWILIO_WHATSAPP_NUMBER}`,
        to: `whatsapp:${to}`,
      });
      return true;
    } catch (error) {
      console.error('WhatsApp error:', error);
      return false;
    }
{{else}}
    // Custom Twilio method: {{name}}
    console.log('⚠ Custom Twilio method needs implementation: {{name}}');
    return false;
{{/if}}
{{else}}
    // Custom helper method: {{name}}
    console.log('⚠ Custom helper method needs implementation: {{name}}');
    console.log('  Integration: {{../integration}}');
    throw new Error('Custom helper method needs implementation');
{{/if}}
  }

{{/each}}
}

export default new {{pascalCase name}}Helper();

