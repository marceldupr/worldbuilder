import { PrismaClient } from '@prisma/client';
import type { Create{{pascalCase name}}Dto, Update{{pascalCase name}}Dto } from './{{kebabCase name}}.entity';

const prisma = new PrismaClient();

/**
 * {{name}} Service
 * {{description}}
 */

export class {{pascalCase name}}Service {
  /**
   * Create a new {{name}}
   */
  async create(data: Create{{pascalCase name}}Dto) {
    return await prisma.{{camelCase name}}.create({
      data,
    });
  }

  /**
   * Find {{name}} by ID
   */
  async findById(id: string) {
    return await prisma.{{camelCase name}}.findUnique({
      where: { id },
{{#if relationships}}
      include: {
{{#each relationships}}
        {{camelCase name}}: true,
{{/each}}
      },
{{/if}}
    });
  }

  /**
   * Find all {{pluralize name}}
   */
  async findAll(options?: {
    skip?: number;
    take?: number;
    orderBy?: any;
    where?: any;
  }) {
    return await prisma.{{camelCase name}}.findMany({
      ...options,
{{#if relationships}}
      include: {
{{#each relationships}}
        {{camelCase name}}: true,
{{/each}}
      },
{{/if}}
    });
  }

  /**
   * Update {{name}}
   */
  async update(id: string, data: Update{{pascalCase name}}Dto) {
    return await prisma.{{camelCase name}}.update({
      where: { id },
      data,
    });
  }

  /**
   * Delete {{name}}
   */
  async delete(id: string) {
    return await prisma.{{camelCase name}}.delete({
      where: { id },
    });
  }

  /**
   * Count {{pluralize name}}
   */
  async count(where?: any) {
    return await prisma.{{camelCase name}}.count({ where });
  }

{{#if behaviors}}
{{#each behaviors}}
{{#if (eq type 'custom_method')}}
  /**
   * {{description}}
   */
  async {{camelCase name}}(id: string{{#if parameters}}, {{parameters}}{{/if}}) {
    const entity = await this.findById(id);
    if (!entity) {
      throw new Error('{{../name}} not found');
    }
    
    {{#if logic}}
    // Generated business logic
    {{logic}}
    {{else}}
    // Custom method: {{name}}
    // Implementation based on: {{description}}
    
    // Update the entity
    const updated = await this.update(id, {
      // Add your field updates here based on the method logic
    });
    
    return updated;
    {{/if}}
  }

{{/if}}
{{/each}}
{{/if}}
}

// Export singleton instance
export const {{camelCase name}}Service = new {{pascalCase name}}Service();

