/**
 * {{pascalCase name}} Detail Page
 * Generated by Worldbuilder
 */

import { useParams, useNavigate } from 'react-router-dom';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import {
  Box,
  Button,
  Paper,
  Typography,
  Grid,
  Chip,
  Alert,
  CircularProgress,
  Divider,
} from '@mui/material';
import {
  ArrowBack as BackIcon,
  Edit as EditIcon,
  Delete as DeleteIcon,
} from '@mui/icons-material';
import { api } from '../lib/api-client';

export function {{pascalCase name}}DetailPage() {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const queryClient = useQueryClient();

  // Fetch data with relationships
  const \{ data, isLoading, error \} = useQuery(\{
    queryKey: ['{{camelCase name}}', id],
    queryFn: () => api.{{camelCase name}}.getById(id!, true),
    enabled: !!id,
  \});

  // Delete mutation
  const deleteMutation = useMutation(\{
    mutationFn: () => api.{{camelCase name}}.delete(id!),
    onSuccess: () => \{
      navigate('/{{kebabCase name}}');
    \},
  \});

  const handleDelete = async () => {
    if (window.confirm('Are you sure you want to delete this {{lowerCase name}}?')) {
      await deleteMutation.mutateAsync();
    }
  };

  if (isLoading) {
    return (
      <Box display="flex" justifyContent="center" alignItems="center" minHeight="60vh">
        <CircularProgress />
      </Box>
    );
  }

  if (error || !data) {
    return (
      <Box p={3}>
        <Alert severity="error">Failed to load {{lowerCase name}}</Alert>
      </Box>
    );
  }

  return (
    <Box p={3}>
      <Box display="flex" justifyContent="space-between" alignItems="center" mb={3}>
        <Box display="flex" alignItems="center" gap={2}>
          <Button
            variant="outlined"
            startIcon=\{<BackIcon />}
            onClick=\{() => navigate('/{{kebabCase name}}')}
          >
            Back
          </Button>
          <Typography variant="h4">{{pascalCase name}} Details</Typography>
        </Box>
        <Box display="flex" gap={1}>
          <Button
            variant="contained"
            startIcon=\{<EditIcon />}
            onClick=\{() => navigate(`/{{kebabCase name}}/$\{id}/edit`)}
          >
            Edit
          </Button>
          <Button
            variant="outlined"
            color="error"
            startIcon=\{<DeleteIcon />}
            onClick=\{handleDelete}
          >
            Delete
          </Button>
        </Box>
      </Box>

      <Paper sx=\{{ p: 3 }}>
        <Grid container spacing={3}>
          {{#each schema.properties}}
          <Grid item xs={12} sm={6}>
            <Typography variant="caption" color="text.secondary">
              {{titleCase name}}
            </Typography>
            <Typography variant="body1" fontWeight={500}>
              {{#if (eq type "boolean")}}
                <Chip
                  label=\{data.{{camelCase name}} ? 'Yes' : 'No'\}
                  color=\{data.{{camelCase name}} ? 'success' : 'default'\}
                  size="small"
                />
              {{else if (eq type "enum")}}
                <Chip label=\{data.{{camelCase name}}\} size="small" />
              {{else if (eq type "date")}}
                \{new Date(data.{{camelCase name}}).toLocaleDateString()\}
              {{else if (eq type "datetime")}}
                \{new Date(data.{{camelCase name}}).toLocaleString()\}
              {{else if (eq type "image")}}
                <img 
                  src=\{data.{{camelCase name}}\} 
                  alt="{{titleCase name}}" 
                  style=\{{ maxWidth: '200px', borderRadius: '8px' }}
                />
              {{else if (eq type "json")}}
                <pre style=\{{ fontSize: '12px', overflow: 'auto' }}>
                  \{JSON.stringify(data.{{camelCase name}}, null, 2)\}
                </pre>
              {{else}}
                \{data.{{camelCase name}} || '-'\}
              {{/if}}
            </Typography>
          </Grid>
          {{/each}}

          {{#each schema.relationships}}
          {{#if (eq type "belongsTo")}}
          <Grid item xs={12} sm={6}>
            <Typography variant="caption" color="text.secondary">
              {{titleCase to}}
            </Typography>
            <Typography variant="body1" fontWeight={500}>
              \{data.{{camelCase fieldName}}?.name || data.{{camelCase fieldName}}?.title || data.{{camelCase fieldName}}?.email || 'N/A'\}
            </Typography>
          </Grid>
          {{/if}}
          {{/each}}
        </Grid>

        <Divider sx=\{{ my: 3 }} />

        <Grid container spacing={3}>
          <Grid item xs={12} sm={6}>
            <Typography variant="caption" color="text.secondary">
              Created At
            </Typography>
            <Typography variant="body2">
              \{new Date(data.createdAt).toLocaleString()\}
            </Typography>
          </Grid>
          <Grid item xs={12} sm={6}>
            <Typography variant="caption" color="text.secondary">
              Updated At
            </Typography>
            <Typography variant="body2">
              \{new Date(data.updatedAt).toLocaleString()\}
            </Typography>
          </Grid>
        </Grid>
      </Paper>
    </Box>
  );
}

