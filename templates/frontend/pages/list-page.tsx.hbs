/**
 * {{pascalCase name}} List Page
 * Generated by Worldbuilder
 */

import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import {
  Box,
  Button,
  Paper,
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  TablePagination,
  IconButton,
  Typography,
  TextField,
  InputAdornment,
  Chip,
  Alert,
  CircularProgress,
} from '@mui/material';
import {
  Add as AddIcon,
  Edit as EditIcon,
  Delete as DeleteIcon,
  Visibility as ViewIcon,
  Search as SearchIcon,
} from '@mui/icons-material';
import { api } from '../lib/api-client';

export function {{pascalCase name}}ListPage() {
  const navigate = useNavigate();
  const queryClient = useQueryClient();
  const [page, setPage] = useState(0);
  const [limit, setLimit] = useState(10);
  const [search, setSearch] = useState('');

  // Fetch data with relationships
  const \{ data, isLoading, error \} = useQuery(\{
    queryKey: ['{{camelCase name}}', page, limit, search],
    queryFn: () => api.{{camelCase name}}.getAll(\{ page: page + 1, limit, include: true \}),
  \});

  // Delete mutation
  const deleteMutation = useMutation(\{
    mutationFn: (id: string) => api.{{camelCase name}}.delete(id),
    onSuccess: () => \{
      queryClient.invalidateQueries(\{ queryKey: ['{{camelCase name}}'] \});
    \},
  \});

  const handleDelete = async (id: string) => {
    if (window.confirm('Are you sure you want to delete this {{lowerCase name}}?')) {
      await deleteMutation.mutateAsync(id);
    }
  };

  if (error) {
    return (
      <Box p={3}>
        <Alert severity="error">Failed to load {{pluralize (lowerCase name)}}</Alert>
      </Box>
    );
  }

  return (
    <Box p={3}>
      <Box display="flex" justifyContent="space-between" alignItems="center" mb={3}>
        <Typography variant="h4">{{pluralize (pascalCase name)}}</Typography>
        <Button
          variant="contained"
          startIcon=\{<AddIcon />}
          onClick=\{() => navigate('/{{kebabCase name}}/new')}
        >
          Create {{pascalCase name}}
        </Button>
      </Box>

      <Paper>
        <Box p={2}>
          <TextField
            fullWidth
            placeholder="Search {{pluralize (lowerCase name)}}..."
            value={search}
            onChange={(e) => setSearch(e.target.value)}
            InputProps=\{{
              startAdornment: (
                <InputAdornment position="start">
                  <SearchIcon />
                </InputAdornment>
              ),
            }}
          />
        </Box>

        {isLoading ? (
          <Box display="flex" justifyContent="center" p={4}>
            <CircularProgress />
          </Box>
        ) : (
          <>
            <TableContainer>
              <Table>
                <TableHead>
                  <TableRow>
                    {{#each schema.properties}}
                    {{#if (isVisibleColumn name type)}}
                    <TableCell>{{titleCase name}}</TableCell>
                    {{/if}}
                    {{/each}}
                    {{#each schema.relationships}}
                    {{#if (eq type "belongsTo")}}
                    <TableCell>{{titleCase to}}</TableCell>
                    {{/if}}
                    {{/each}}
                    <TableCell align="right">Actions</TableCell>
                  </TableRow>
                </TableHead>
                <TableBody>
                  \{data?.data.map((item) => (
                    <TableRow key=\{item.id} hover>
                      {{#each schema.properties}}
                      {{#if (isVisibleColumn name type)}}
                      <TableCell>
                        {{#if (eq type "boolean")}}
                          <Chip
                            label=\{item.{{camelCase name}} ? 'Yes' : 'No'\}
                            color=\{item.{{camelCase name}} ? 'success' : 'default'\}
                            size="small"
                          />
                        {{else if (eq type "enum")}}
                          <Chip label=\{item.{{camelCase name}}\} size="small" />
                        {{else if (eq type "date")}}
                          \{new Date(item.{{camelCase name}}).toLocaleDateString()\}
                        {{else if (eq type "datetime")}}
                          \{new Date(item.{{camelCase name}}).toLocaleString()\}
                        {{else}}
                          \{item.{{camelCase name}}\}
                        {{/if}}
                      </TableCell>
                      {{/if}}
                      {{/each}}
                      {{#each schema.relationships}}
                      {{#if (eq type "belongsTo")}}
                      <TableCell>
                        \{item.{{camelCase fieldName}}?.name || item.{{camelCase fieldName}}?.title || item.{{camelCase fieldName}}?.email || 'N/A'\}
                      </TableCell>
                      {{/if}}
                      {{/each}}
                      <TableCell align="right">
                        <IconButton
                          size="small"
                          onClick=\{() => navigate(`/{{kebabCase name}}/$\{item.id}`)}
                          title="View"
                        >
                          <ViewIcon />
                        </IconButton>
                        <IconButton
                          size="small"
                          onClick=\{() => navigate(`/{{kebabCase name}}/$\{item.id}/edit`)}
                          title="Edit"
                        >
                          <EditIcon />
                        </IconButton>
                        <IconButton
                          size="small"
                          onClick=\{() => handleDelete(item.id)}
                          title="Delete"
                          color="error"
                        >
                          <DeleteIcon />
                        </IconButton>
                      </TableCell>
                    </TableRow>
                  ))}
                </TableBody>
              </Table>
            </TableContainer>

            <TablePagination
              component="div"
              count=\{data?.pagination.total || 0}
              page=\{page}
              onPageChange=\{(_, newPage) => setPage(newPage)}
              rowsPerPage=\{limit}
              onRowsPerPageChange=\{(e) => {
                setLimit(parseInt(e.target.value, 10));
                setPage(0);
              }}
            />
          </>
        )}
      </Paper>
    </Box>
  );
}

