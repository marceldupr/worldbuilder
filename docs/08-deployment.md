# Worldbuilder - Deployment Strategy

## Deployment Philosophy

**"From canvas to production in one click"**

Worldbuilder handles the entire deployment pipeline: GitHub integration, containerization, environment configuration, and one-click deployment to Railway (or other platforms).

---

## Deployment Architecture

```
Worldbuilder Canvas
       â†“
Generate Code
       â†“
Commit to GitHub
       â†“
Trigger CI/CD
       â†“
Build Container
       â†“
Run Tests
       â†“
Deploy to Railway
       â†“
Live Production System
```

---

## GitHub Integration

### Repository Creation

When user creates a new project:

```typescript
class GitHubIntegration {
  async createRepository(
    projectName: string,
    userId: string
  ): Promise<Repository> {
    const octokit = new Octokit({
      auth: await this.getUserToken(userId),
    });

    // Create repository
    const repo = await octokit.repos.createForAuthenticatedUser({
      name: projectName,
      description: `Generated by Worldbuilder`,
      private: true,
      auto_init: true,
    });

    // Set up branch protection
    await octokit.repos.updateBranchProtection({
      owner: repo.data.owner.login,
      repo: repo.data.name,
      branch: 'main',
      required_status_checks: {
        strict: true,
        contexts: ['test', 'build'],
      },
      enforce_admins: true,
      required_pull_request_reviews: null,
      restrictions: null,
    });

    return repo.data;
  }
}
```

### Initial Commit

```typescript
async function createInitialCommit(
  projectCode: GeneratedCode,
  repo: Repository
): Promise<void> {
  const octokit = new Octokit({ auth: token });

  // Create all files
  for (const file of projectCode.files) {
    await octokit.repos.createOrUpdateFileContents({
      owner: repo.owner.login,
      repo: repo.name,
      path: file.path,
      message: `Initial commit: ${file.path}`,
      content: Buffer.from(file.content).toString('base64'),
    });
  }

  // Create .github/workflows for CI/CD
  await this.createCICDWorkflow(repo);
}
```

### Continuous Commits

When user updates components:

```typescript
async function commitChanges(
  changes: FileChange[],
  commitMessage: string
): Promise<void> {
  // Create branch for changes
  const branch = `worldbuilder-update-${Date.now()}`;
  await createBranch(repo, branch);

  // Commit changes to branch
  for (const change of changes) {
    await commitFile(repo, branch, change);
  }

  // Create pull request
  const pr = await createPullRequest(repo, {
    title: commitMessage,
    head: branch,
    base: 'main',
    body: generatePRDescription(changes),
  });

  // If all tests pass, auto-merge
  if (await allTestsPassed(pr)) {
    await mergePullRequest(pr);
  }
}
```

---

## Generated Repository Structure

### Complete Project

```
username/ecommerce-platform/
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â”œâ”€â”€ test.yml
â”‚   â”‚   â”œâ”€â”€ deploy.yml
â”‚   â”‚   â””â”€â”€ security.yml
â”‚   â””â”€â”€ dependabot.yml
â”‚
â”œâ”€â”€ .husky/
â”‚   â”œâ”€â”€ pre-commit
â”‚   â””â”€â”€ pre-push
â”‚
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma
â”‚   â””â”€â”€ migrations/
â”‚
â”œâ”€â”€ src/
â”‚   â””â”€â”€ ... (application code)
â”‚
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ ... (test files)
â”‚
â”œâ”€â”€ .dockerignore
â”œâ”€â”€ .env.example
â”œâ”€â”€ .eslintrc.js
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .prettierrc
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ jest.config.js
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â”œâ”€â”€ tsconfig.json
â””â”€â”€ railway.json
```

---

## Containerization

### Generated Dockerfile

```dockerfile
# Multi-stage build for optimization
FROM node:20-alpine AS builder

WORKDIR /app

# Copy package files
COPY package*.json ./
COPY prisma ./prisma/

# Install dependencies
RUN npm ci

# Copy source
COPY . .

# Generate Prisma client
RUN npx prisma generate

# Build TypeScript
RUN npm run build

# Production stage
FROM node:20-alpine

WORKDIR /app

# Install production dependencies only
COPY package*.json ./
RUN npm ci --only=production

# Copy built application
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/prisma ./prisma
COPY --from=builder /app/node_modules/.prisma ./node_modules/.prisma

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=40s \
  CMD node -e "require('http').get('http://localhost:3000/health', (r) => { process.exit(r.statusCode === 200 ? 0 : 1) })"

# Run migrations and start
CMD ["sh", "-c", "npx prisma migrate deploy && node dist/index.js"]

EXPOSE 3000
```

### Docker Compose for Local Development

```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - DATABASE_URL=postgresql://postgres:postgres@db:5432/app
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis
    volumes:
      - ./src:/app/src
      - ./prisma:/app/prisma

  db:
    image: postgres:15-alpine
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=app
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  worker:
    build: .
    command: node dist/workers/index.js
    environment:
      - NODE_ENV=development
      - DATABASE_URL=postgresql://postgres:postgres@db:5432/app
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis

volumes:
  postgres_data:
  redis_data:
```

---

## CI/CD Pipeline

### GitHub Actions: Test Workflow

```yaml
# .github/workflows/test.yml
name: Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: test_db
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 5432:5432

      redis:
        image: redis:7
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 6379:6379

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Generate Prisma Client
        run: npx prisma generate

      - name: Run migrations
        run: npx prisma migrate deploy
        env:
          DATABASE_URL: postgresql://postgres:postgres@localhost:5432/test_db

      - name: Lint
        run: npm run lint

      - name: Type check
        run: npm run type-check

      - name: Run unit tests
        run: npm run test:unit
        env:
          DATABASE_URL: postgresql://postgres:postgres@localhost:5432/test_db
          REDIS_URL: redis://localhost:6379

      - name: Run integration tests
        run: npm run test:integration
        env:
          DATABASE_URL: postgresql://postgres:postgres@localhost:5432/test_db
          REDIS_URL: redis://localhost:6379

      - name: Run E2E tests
        run: npm run test:e2e
        env:
          DATABASE_URL: postgresql://postgres:postgres@localhost:5432/test_db
          REDIS_URL: redis://localhost:6379

      - name: Check coverage
        run: npm run test:coverage

      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          token: ${{ secrets.CODECOV_TOKEN }}

      - name: Validate enforced tests
        run: npm run test:enforced
```

### GitHub Actions: Security Workflow

```yaml
# .github/workflows/security.yml
name: Security

on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 0 * * 0' # Weekly

jobs:
  security:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Run npm audit
        run: npm audit --audit-level=high

      - name: Run Snyk security scan
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}

      - name: Run Trivy vulnerability scanner
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: 'fs'
          scan-ref: '.'
          severity: 'CRITICAL,HIGH'
```

### GitHub Actions: Deploy Workflow

```yaml
# .github/workflows/deploy.yml
name: Deploy

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    needs: test

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install Railway CLI
        run: npm install -g @railway/cli

      - name: Deploy to Railway
        run: railway up
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}

      - name: Run post-deploy migrations
        run: railway run npx prisma migrate deploy
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}

      - name: Notify deployment
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          text: 'Deployment to production completed'
          webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

---

## Railway Configuration

### railway.json

```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "DOCKERFILE",
    "dockerfilePath": "Dockerfile"
  },
  "deploy": {
    "numReplicas": 1,
    "sleepApplication": false,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

### Railway Services

Worldbuilder automatically provisions:

1. **Web Service** (Express API)
   - Dockerfile build
   - Auto-scaling
   - Health checks
   - Custom domain support

2. **Worker Service** (BullMQ workers)
   - Same container, different command
   - Separate scaling

3. **PostgreSQL** (Supabase or Railway)
   - Managed database
   - Automatic backups
   - Connection pooling

4. **Redis** (Railway)
   - Job queue
   - Caching
   - Session storage

### Environment Variables

Automatically configured in Railway:

```bash
# Application
NODE_ENV=production
PORT=3000

# Database (from Supabase)
DATABASE_URL=${{Supabase.DATABASE_URL}}
DIRECT_URL=${{Supabase.DIRECT_URL}}

# Redis (from Railway)
REDIS_URL=${{Redis.REDIS_URL}}

# Auth (from Supabase)
SUPABASE_URL=${{Supabase.URL}}
SUPABASE_ANON_KEY=${{Supabase.ANON_KEY}}
SUPABASE_SERVICE_KEY=${{Supabase.SERVICE_KEY}}

# User-provided secrets
STRIPE_API_KEY=${{secrets.STRIPE_API_KEY}}
SENDGRID_API_KEY=${{secrets.SENDGRID_API_KEY}}
```

---

## Deployment Flow (User Experience)

### Step 1: Configure Deployment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Deploy Configuration                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  GitHub Repository                      â”‚
â”‚  âœ… Connected: username/ecommerce       â”‚
â”‚                                         â”‚
â”‚  Deployment Platform                    â”‚
â”‚  ( ) Railway  ( ) Other                 â”‚
â”‚                                         â”‚
â”‚  Environment Variables                  â”‚
â”‚  âœ… DATABASE_URL (auto)                 â”‚
â”‚  âœ… REDIS_URL (auto)                    â”‚
â”‚  âš ï¸  STRIPE_API_KEY                     â”‚
â”‚  âš ï¸  SENDGRID_API_KEY                   â”‚
â”‚                                         â”‚
â”‚  [Add Secret]                           â”‚
â”‚                                         â”‚
â”‚  Custom Domain (optional)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ api.myapp.com                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚                      [Next]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 2: Pre-Deploy Checks

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pre-Deploy Validation                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  âœ… All tests passing (152/152)         â”‚
â”‚  âœ… No security vulnerabilities          â”‚
â”‚  âœ… Code formatted                      â”‚
â”‚  âœ… Type checking passed                â”‚
â”‚  âœ… Environment variables set           â”‚
â”‚  âœ… Database migrations ready           â”‚
â”‚  âœ… Docker build successful             â”‚
â”‚                                         â”‚
â”‚  Ready to deploy!                       â”‚
â”‚                                         â”‚
â”‚                [Cancel] [Deploy]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 3: Deployment Progress

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Deploying to Railway...                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  âœ… Code pushed to GitHub                â”‚
â”‚  âœ… Container built                      â”‚
â”‚  âœ… Tests passed in CI                   â”‚
â”‚  â³ Deploying to Railway...              â”‚
â”‚     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  75%         â”‚
â”‚                                         â”‚
â”‚  Logs:                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [Railway] Starting deployment...  â”‚ â”‚
â”‚  â”‚ [Railway] Building image...       â”‚ â”‚
â”‚  â”‚ [Railway] Running migrations...   â”‚ â”‚
â”‚  â”‚ [Railway] Starting service...     â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 4: Deployment Success

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Deployment Successful! ğŸ‰              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Your application is live at:           â”‚
â”‚  https://ecommerce-prod.up.railway.app  â”‚
â”‚                                         â”‚
â”‚  API Documentation:                     â”‚
â”‚  https://ecommerce-prod.up.railway.app/ â”‚
â”‚         swagger                         â”‚
â”‚                                         â”‚
â”‚  Services:                              â”‚
â”‚  âœ… Web API (3 instances)                â”‚
â”‚  âœ… Worker (2 instances)                 â”‚
â”‚  âœ… PostgreSQL                           â”‚
â”‚  âœ… Redis                                â”‚
â”‚                                         â”‚
â”‚  Health Check: âœ… Healthy                â”‚
â”‚                                         â”‚
â”‚  [View Dashboard] [View Logs] [Done]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Monitoring & Observability

### Health Checks

Generated health check endpoint:

```typescript
// src/routes/health.ts
import { Router } from 'express';
import { PrismaClient } from '@prisma/client';
import Redis from 'ioredis';

const router = Router();
const prisma = new PrismaClient();
const redis = new Redis(process.env.REDIS_URL);

router.get('/health', async (req, res) => {
  const health = {
    status: 'ok',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    checks: {
      database: 'unknown',
      redis: 'unknown',
    },
  };

  try {
    await prisma.$queryRaw`SELECT 1`;
    health.checks.database = 'healthy';
  } catch (error) {
    health.checks.database = 'unhealthy';
    health.status = 'degraded';
  }

  try {
    await redis.ping();
    health.checks.redis = 'healthy';
  } catch (error) {
    health.checks.redis = 'unhealthy';
    health.status = 'degraded';
  }

  const statusCode = health.status === 'ok' ? 200 : 503;
  res.status(statusCode).json(health);
});

export default router;
```

### Logging

Winston logger configuration:

```typescript
// src/config/logger.ts
import winston from 'winston';

export const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  defaultMeta: {
    service: process.env.SERVICE_NAME || 'api',
    environment: process.env.NODE_ENV,
  },
  transports: [
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.simple()
      ),
    }),
  ],
});
```

### Error Tracking (Sentry)

```typescript
// src/config/sentry.ts
import * as Sentry from '@sentry/node';

if (process.env.SENTRY_DSN) {
  Sentry.init({
    dsn: process.env.SENTRY_DSN,
    environment: process.env.NODE_ENV,
    tracesSampleRate: 0.1,
  });
}
```

---

## Rollback Strategy

### Automatic Rollback

If deployment fails health checks:

```typescript
async function deployWithHealthCheck(): Promise<void> {
  // Deploy new version
  await railway.deploy();

  // Wait for startup
  await sleep(30000);

  // Check health
  const healthy = await checkHealth();

  if (!healthy) {
    console.error('Health check failed, rolling back...');
    await railway.rollback();
    throw new Error('Deployment failed health check');
  }
}
```

### Manual Rollback

UI button to rollback to previous version:

```
Previous Deployments:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ v1.2.3 - 2 hours ago      [Current]   â”‚
â”‚ v1.2.2 - 1 day ago        [Rollback]  â”‚
â”‚ v1.2.1 - 3 days ago       [Rollback]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Migrations

### Migration Strategy

```typescript
// Generated in package.json
{
  "scripts": {
    "migrate:dev": "prisma migrate dev",
    "migrate:deploy": "prisma migrate deploy",
    "migrate:status": "prisma migrate status"
  }
}
```

### Pre-Deployment Migration Check

```typescript
async function checkPendingMigrations(): Promise<void> {
  const { execSync } = require('child_process');
  
  try {
    execSync('npx prisma migrate status');
  } catch (error) {
    throw new Error('Pending migrations detected. Run migrations before deploy.');
  }
}
```

---

## Scaling Configuration

### Auto-Scaling Rules

```json
{
  "scaling": {
    "minReplicas": 1,
    "maxReplicas": 10,
    "targetCPUUtilization": 70,
    "targetMemoryUtilization": 80
  }
}
```

### Load Testing Before Production

```typescript
// Automatically run before first deploy
async function validatePerformance(): Promise<void> {
  const result = await loadTest({
    url: stagingUrl,
    duration: 60,
    connections: 100,
  });

  if (result.errors.rate > 0.01) {
    throw new Error('Error rate too high');
  }

  if (result.latency.p99 > 500) {
    throw new Error('P99 latency too high');
  }
}
```

---

## Cost Estimation

Before deployment, show estimated costs:

```
Estimated Monthly Cost (Railway):

Web Service:      $5  (1 instance, 1GB RAM)
Worker Service:   $5  (1 instance, 1GB RAM)
PostgreSQL:       $10 (Supabase free tier)
Redis:            $5  (Railway)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total:           ~$25/month

(Scales with usage. View detailed pricing)
```

